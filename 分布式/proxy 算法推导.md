## 前言

### 几种问题描述

- n 个节点,写入一个数据,那么 n 个机器都能读到该数据更新.

- 保证所有机器都写入成功,才算成功,显然,这种是一种强一致性.

- 可以放宽一下,将集群看作是一个整体,向集群写入一个数,再读取该数时能读到最新值.

对于第三种描述,加了一个抽象层次,可操作的空间就多了: 读取数据读取全部机器,写入数据写入全部机器.过板书写入成功时,去读全部机器,最新值一定在这个集合中.

如何确定一个值是最新的? 集合中虽然包含了最新值,但是如何找到他呢? 票数最多的不一定就是最新的.描述信息还是太少了,因此,需要增加信息了.	增加一个时间戳,最大时间戳对应的数据一定就是最新的了.



问题来了,最大时间戳仍然是一个分布式问题,因此,还得是一次多数派读写,多数派读的时候,集合中一定包含了时间戳的最新值.	如何从集合中找到该最新值呢? 注意到最新值一定是集合中的最大值.	所以,找到了可以一致性的一个自增时间戳了.

该问题解决后,获取最新数据也就能回答了



因此,分布式问题的关键

- 多数派读写



https://blog.openacid.com/algo/paxos/#%E4%BB%8E%E5%A4%9A%E6%95%B0%E6%B4%BE%E8%AF%BB%E5%86%99%E5%88%B0paxos%E7%9A%84%E6%8E%A8%E5%AF%BC

## 从多数派读写到 paxos 推导

系统中的每个节点对某事有一致的状态

#### 解决思路 1: 复制

##### 主从异步复制:  主写 ok 就算 ok.  主服务器异步写到从服务器 (从服务器可能丢失数据)

##### 主从同步复制:  所有的从服务器都写成功,系统才能对外服务 (一个节点坏了,整个集群就坏了)

**半同步复制:**  主服务器的数据复制到一定数量的从服务器上就算成功 (高可用,由于从库可能不完整,master 从 slave 中恢复数据时可能任何一个 slave 都无法提供完整的数据)

#### 多数派读写





paxos 第二阶段的时候提交到一半的时候中途挂了,导致后面无法再提交,是不是或导致服务不一致?

不会,能到提交阶段,说明第一次申请 id 是成功的,进而说明,id 至少被半数写成功了.
























